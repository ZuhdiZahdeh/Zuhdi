<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>إضافة طالب جديد</title>
</head>
<body>

<input type="text" id="name" placeholder="اسم الطالب">
<input type="text" id="grade" placeholder="الصف">
<input type="email" id="email" placeholder="البريد الإلكتروني">
<input type="text" id="phone" placeholder="الهاتف">

<button id="ID-students">إضافة الطالب</button>

<script type="module">
  import { db } from './firebase-init.js';
  import { doc, getDoc, setDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

  document.getElementById('ID-students').onclick = async function() {
    const name = document.getElementById('name').value;
    const grade = document.getElementById('grade').value;
    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;

    const counterRef = doc(db, 'counters', 'studentsCounter');
    const counterSnap = await getDoc(counterRef);

    if (counterSnap.exists()) {
      const newId = counterSnap.data().ID-lastStudent + 1;

      try {
        await setDoc(doc(db, "students", newId.toString()), {
          name: name,
          grade: grade,
          email: email,
          phone: phone
        });

        await updateDoc(counterRef, {
          ID_lastStudent: increment(1)
        });

        alert("✅ تمت إضافة الطالب بنجاح برقم: " + newId);
      } catch (e) {
        alert("❌ خطأ: " + e);
      }
    } else {
      alert("❌ مستند العداد غير موجود، يرجى التأكد من إنشائه أولًا.");
    }
  };
</script>

</body>
</html>
